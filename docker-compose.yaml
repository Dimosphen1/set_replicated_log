version: "3"
services:
  master:
    build:
      context: .
      dockerfile: master/Dockerfile
    networks:
      - system-network
    environment:
      - HOST=master
      - PORT=8080
      - SECONDARY_HOSTS=secondary-1,secondary-2
      - SECONDARY_SECRET=some_secret
      - WRITE_CONCERN=2
      - QUORUM=1
      - REPLICATE_TIMEOUT=1
      - MAX_RETRIES=5
      - HEALTHCHECK_INTERVAL=2
      - HEALTHCHECK_REQUEST_TIMEOUT=1
      - HEALTHCHECK_SUSPECT_THRESHOLD=2
    ports:
      - "8080:8080"
    container_name: master

  secondary-1:
    build:
      context: .
      dockerfile: secondary/Dockerfile
    networks:
      - system-network
    environment:
      - HOST=secondary-1
      - PORT=8081
      - MASTER_HOST=master
      - SECONDARY_SECRET=some_secret
    ports:
      - "8081:8081"
    container_name: secondary-1

  secondary-2:
    build:
      context: .
      dockerfile: secondary/Dockerfile
    networks:
      - system-network
    environment:
      - HOST=secondary-2
      - PORT=8082
      - MASTER_HOST=master
      - SLEEP=5
      - SECONDARY_SECRET=some_secret
    ports:
      - "8082:8082"
    container_name: secondary-2

networks:
  system-network:
    driver: bridge